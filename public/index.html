<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	
	<!-- jQuery -->
	<script src="vendor/foundation/js/vendor/jquery.js"></script>

	<!-- Fast Click -->
	<script src="vendor/foundation/js/vendor/fastclick.js"></script>

	<!-- Foundation -->
	<link rel="stylesheet" href="vendor/foundation/css/foundation.min.css" />
	<script src="vendor/foundation/js/foundation.min.js"></script>
	
	<!-- Custom -->
	<link rel="stylesheet" href="style.css" />
</head>
<body>
	<img class="large-6 large-offset-3 columns" src="images/banner.jpg" />
	<form class="large-6 large-offset-3 columns" id="form" action="/submit" method="POST" data-abide style="padding-top: 16px;">
		<div class="row" style="padding-bottom: 16px;">
			<div class="medium-12 columns">
				<strong>Want to learn how to cook up recipes for a delicious kitchen?</strong><br/>
				<p>Get inspired with a copy of the new 2016 IKEA catalogue fresh off the stove, and delivered warm to your door step.<br/></p>
				<p>Sign up to receive an IKEA catalogue of your own by filling in your details below. Registration is only available to Malaysian residents.</p>
				<a href="#" data-reveal-id="tnc" style="display: inline">Terms and Conditions apply.</a>
			</div>
		</div>
		<div class="row">
			<div class="medium-6 columns">
				<label>Name <small>required</small>
					<input id="name" type="text" name="name" maxlength="32" required pattern="[a-zA-Z\s]+" />
				</label>
				<small class="error">Name is required</small>
			</div>
			<div class="medium-6 columns">
				<label>Email <small>required</small>
					<input id="email" type="email" name="email" maxlength="254" required pattern="email"/>
				</label>
				<small class="error">Email is required</small>
			</div>
		</div>
		<div class="row">
			<div class="medium-6 columns">
				<label>Address 1 <small>required</small>
					<input id="address1" type="text" name="address1" maxlength="64" required />
				</label>
				<small class="error">Address 1 is required</small>
			</div>
			<div class="medium-6 columns">
				<label>Address 2
					<input id="address2" type="text" name="address2" maxlength="64" />
				</label>
			</div>
		</div>
		<div class="row">
			<div class="medium-3 columns">
				<div class="row">
					<div class="medium-12 columns">
						<label>Postal Code <small>required</small></label>
					</div>
				</div>
				<div class="row">
					<div class="medium-12 columns">
						<input id="postal_code" type="text" name="postal_code" placeholder="5 digits only" maxlength="5" required pattern="[0-9][0-9][0-9][0-9][0-9]"/>
						<small class="error">Postal code must be 5 digits</small>
					</div>
				</div>
			</div>
			<div class="medium-3 columns">
				<label>City <small>required</small>
					<input id="city" type="text" name="city" maxlength="64" required />
				</label>
				<small class="error">City is required</small>
			</div>
			<div class="medium-3 columns">
				<label>State
					<select id="state" name="state" required>
						<option value="">Choose your country state</option>
						<option value="Johor">Johor</option>
						<option value="Kedah">Kedah</option>
						<option value="Kelantan">Kelantan</option>
						<option value="Malacca">Malacca</option>
						<option value="Negeri Sembilan">Negeri Sembilan</option>
						<option value="Pahang">Pahang</option>
						<option value="Perak">Perak</option>
						<option value="Perlis">Perlis</option>
						<option value="Penang">Penang</option>
						<option value="Sabah">Sabah</option>
						<option value="Sarawak">Sarawak</option>
						<option value="Selangor">Selangor</option>
						<option value="Terengganu">Terengganu</option>
					</select>
				</label>
				<small class="error">State is required</small>
			</div>
			<div class="medium-3 columns">
				<label>Country
					<input id="country" type="text" name="country" value="Malaysia" readonly />
				</label>
			</div>
		</div>
		<div class="row">
			<div class="medium-12 columns">
				<label>
					<input id="agree" type="checkbox" name="agree" required>
						<label for="agree">I Agree to the Terms & Conditions</label>
					</input>
				</label>
				<small class="error">You must agree to the Terms & Conditions</small>
			</div>
		</div>
		<div class="row" style="padding-bottom: 16px">
			<div class="medium-12 columns">
				<button type="submit" style="display: block; margin: 0 auto; background: #003399;">Submit</button>
			</div>
		</div>
	</form>

	<div id="outofstock2" class="medium-6 medium-offset-3 columns" style="display: none">
		<h3>Sorry!</h3>
		<h5>All the IKEA catalogues have been snapped up. Head down to the IKEA store from the XXth of September to get a copy of the 2016 IKEA catalogue for yourself.</h5>
	</div>

	<div id="tnc" class="reveal-modal" data-reveal aria-labelledby="tnc-button" aria-hidden="true" role="dialog">
		<h5>Terms & conditions</h5>

		<p>PLEASE CAREFULLY READ THE PROVISIONS BELOW BEFORE PROVIDING YOUR PERSONAL DATA TO PARTICIPATE IN THE GIVEAWAY.</p><br/>

		<p>BY PROVIDING YOUR PERSONAL DATA PURSUANT TO THE STATUTORY REQUIREMENTS OF THE PERSONAL DATA PROTECTION ACT 2010, YOU ACKNOWLEDGE THAT YOU HAVE READ AND FULLY UNDERSTAND THE CONTENTS OF THE PROVISIONS AND YOU HEREBY GIVE YOUR CONSENT AS SET OUT BELOW.</p><br/>

		<p>By submitting your personal data (which includes names, mailing addresses, email addresses and/or any other data attribute establishing the personal identity) you consent to Ikano Pte Ltd collecting, using, disclosing and/or processing your personal data for the purpose of “2016 IKEA Catalogue Giveaway”.</p><br/>

		<p>During your course of dealing with us, we will process your personal data for the above mentioned purpose, including, to communicate with you, provide products and/or services to you, respond to your enquiries or complaints, provide you with information and/or updates on products, services and/or promotions offered by Ikano Pte Ltd, identify you (including publishing your name and photograph) when you participate in the giveaway organised by us and other purposes required to operate and maintain our business as set out in our Personal Data Privacy Policy (collectively referred to as “Purposes”).</p><br/>

		<p>For more details, please refer to our “Personal Data Privacy Policy” as published on our website <a href="http://www.IKEA.com.my/pdpa">www.IKEA.com.my/pdpa</a></p>
		<a class="close-reveal-modal" aria-label="Close">&#215;</a>
	</div>
	<div id="success" class="reveal-modal" data-reveal aria-hidden="true" role="dialog">
		<h3 class="message">Thank You!</h3>
		<h5 class="message">You've got yourself a copy of the 2016 IKEA catalogue, filled with delicious ideas to help you cook up a storm in the kitchen. Please give us 1-2 weeks  to deliver the catalogue to your home.</h5>
		<a class="close-reveal-modal" aria-label="Close">&#215;</a>
	</div>
	<div id="outofstock" class="reveal-modal" data-reveal aria-hidden="true" role="dialog">
		<h3 class="message">Sorry!</h3>
		<h5 class="message">All the IKEA catalogues have been snapped up. Head down to the IKEA store from the XXth of September to get a copy of the 2016 IKEA catalogue for yourself.</h5>
		<a class="close-reveal-modal" aria-label="Close">&#215;</a>
	</div>
	<div id="duplicate" class="reveal-modal" data-reveal aria-hidden="true" role="dialog">
		<h3 class="message">Sorry!</h3>
		<h5 class="message">You've already submitted your details before.</h5>
	</div>
	<div id="failed" class="reveal-modal" data-reveal aria-hidden="true" role="dialog">
		<h3 class="message">Error!</h3>
		<h5 class="message">Sorry! the server failed to process the data for some reason.</h5>
		<a class="close-reveal-modal" aria-label="Close">&#215;</a>
	</div>
	<script>
		$(document).foundation();
		$(document).ready(function() {
			$.ajax({
				url: "/count",
				method: "GET",
			}).done(function(resp) {
				var n = parseInt(resp);
				if (n > 8000) {
					$("#form").css({display: "none"});
					$("#outofstock2").css({display: "block"});
				}
			}).fail(function(resp) {
				console.log(resp.responseText);
			});

			$("#form").submit(function(evt) {
				evt.preventDefault();

				var form = evt.target;
				if (form.elements["name"].value.length == 0 ||
				    form.elements["address1"].value.length == 0 ||
				    form.elements["city"].value.length == 0 ||
				    form.elements["state"].value.length == 0 ||
				    form.elements["country"].value.length == 0 ||
				    form.elements["email"].value.length == 0 ||
				    form.elements["postal_code"].value.length == 0 ||
				    form.elements["agree"].checked == false) {
				    return false;
				}

				$.ajax({
					url: evt.target.action,
					method: "POST",
					data: $(evt.target).serialize(),
				}).done(function(resp) {
					$("#success").foundation("reveal", "open");
				}).fail(function(resp) {
					if (resp.responseText.indexOf("out of stock") >= 0) {
						$("#outofstock").foundation("reveal", "open");
					} else if (resp.responseText.indexOf("duplicate") >= 0) {
						$("#duplicate").foundation("reveal", "open");
					} else if (resp.status >= 500) {
						$("#failed").foundation("reveal", "open");
					}
				});
			});
		});
	</script>
</body>
</html>
